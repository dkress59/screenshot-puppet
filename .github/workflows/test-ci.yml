# This workflow will do a clean install of node dependencies, build the source code and run tests across different versions of node
# For more information see: https://help.github.com/actions/language-and-framework-guides/using-nodejs-with-github-actions

name: Test CI

on:
  push:
    branches: [ module, master ]
  pull_request:
    branches: [ master ]


jobs:
    test:
        runs-on: ubuntu-latest
        steps:
            - uses: actions/checkout@v2
            - uses: actions/setup-node@v2-beta
              with:
                  node-version: '15'
                  check-latest: true
            - name: Yarn Install
              run: yarn
              if: |
                  steps.cache-yarn-cache.outputs.cache-hit != 'true' ||
                  steps.cache-node-modules.outputs.cache-hit != 'true'
            - name: Eslint Check
              run: yarn check:script
            - name: Test
              run: yarn test
            - name: Upload Coverage Report
              uses: codecov/codecov-action@v1
              with:
                  token: ${{ secrets.CODECOV_TOKEN }}
                  file: ./coverage/coverage-final.json
